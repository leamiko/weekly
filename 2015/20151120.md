###苏州市融合通信重点实验室周报(11月13日——11月20日)
	作者：姚善良 iat                   小组：PHP                        时间：2015年11月20日
###进度报告
#####本周完成的事情

1、	金融曝光平台

（1）	协助测试，发现定位问题。

（2）	投诉状态的问题，之前理解的是用户反馈后将反馈的状态设置为“处理中”，这时候公司可能还没反馈；如果用户再点击“同意/不同意”的话，则状态条显示中“公司反馈时间”就会有问题。咨询产品后，将用户反馈时改为不涉及到反馈状态的修改，只有当公司反馈了，反馈的状态才改为“处理中”。

（3）	产品增加需求，在用户投诉的时候，如果该公司已经入驻，且填写邮箱，则发送邮件通知该公司，请求处理；如果还没入驻的话，则不发送。

（4）	发现定时更新js的脚本存在问题，增加请求成功的日志记录，发现即使两分钟更新一次，但是实际的日志中还是有丢失的。

（5）	解决提案中的sql注入、xss安全问题。之前使用的是htmlspecialchars，没有加第二个参数ENT_QUOTES ，导致单引号没有被编码，出现了sql注入的漏洞；另外html特殊字符没有转义，出现了xss。后来使用htmlentities，发现htmlentities会连中文字符也给转化了，中文会出现乱码的情况。咨询同事后得知php5web中有个函数qstr可以处理，查看源码发现内部其实就是mysql_real_escape_string函数，转义 SQL 语句中使用的字符串中的特殊字符。最终的解决办法是，整型加int处理，字符型用htmlspecialchars(strip_tags($a), ENT_QUOTES)。

（6）	测试提出短信发不出，代码并没有修改，后来联系短信服务提供者，得知新浪1065移动通道已经暂停，因此将新浪1065移动通道的项目切换至了微梦1065移动通道上，所以移动用户的签名目前没办法更改，联通与电信是正常的。

（7）	增加“用户”和“公司”角色“我的投诉”页面的强制跳转，防止出现用户公司之间页面互相可见的情况。

（8）	部分数据库信息修改

* 行业名称的修改，人寿保险->寿险，财产保险->财险
* 银行名称的修改，浦东发展银行->浦发银行，北京农村商业银行->北京农商行，邮政储蓄银行->邮储银行，上海农村商业银行->上海农商行

2、	其它

（1）	财经页面信息核实，某某页与某某页的数据显示不一致，查看两个项目对应的代码，发现K线用的是某某_new表，而行情中心的查询使用的是某某表，咨询对应同事后明白可以统一使用某某_new表，遂解决提案。



#####待解决问题及下一步计划
* 用户中心
* 金融曝光平台

###简述
